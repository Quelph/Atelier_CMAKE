name: Automatisation des tests

on: push

jobs:

  Compilation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4 # Bonne pratique : passer en v4

      - name: Configuration et Compilation
        run: |
          # Rappel : assurez-vous que votre CMakeLists.txt racine utilise 'add_subdirectory(src)'
          mkdir build
          cd build
          cmake ..
          make
          
      - name: Sauvegarder l'exécutable 'calculator' comme artefact
        uses: actions/upload-artifact@v4 # <-- CORRIGÉ : Utilisation de v4
        with:
          name: build-artifacts
          path: build/calculator 
          # Assurez-vous que le chemin 'build/calculator' pointe vers votre binaire !


  Test_Add:
    runs-on: ubuntu-latest
    needs: Compilation
    steps:
      - name: Télécharger l'exécutable
        uses: actions/download-artifact@v4 # <-- CORRIGÉ : Utilisation de v4
        with:
          name: build-artifacts
          
      - name: Rendre l'exécutable
        run: chmod +x calculator
          
      - name: Test ADD
        run: ./calculator add 10 5


  Test_Sub:
    runs-on: ubuntu-latest
    needs: Compilation
    steps:
      - name: Télécharger l'exécutable
        uses: actions/download-artifact@v4 # <-- CORRIGÉ : Utilisation de v4
        with:
          name: build-artifacts
          
      - name: Rendre l'exécutable
        run: chmod +x calculator
          
      - name: Test SUB
        run: ./calculator sub 10 5


  Test_Mul:
    runs-on: ubuntu-latest
    needs: Compilation
    steps:
      - name: Télécharger l'exécutable
        uses: actions/download-artifact@v4 # <-- CORRIGÉ : Utilisation de v4
        with:
          name: build-artifacts
          
      - name: Rendre l'exécutable
        run: chmod +x calculator
          
      - name: Test MUL
        run: ./calculator mul 4 5


  Test_Div:
    runs-on: ubuntu-latest
    needs: Compilation
    steps:
      - name: Télécharger l'exécutable
        uses: actions/download-artifact@v4 # <-- CORRIGÉ : Utilisation de v4
        with:
          name: build-artifacts
          
      - name: Rendre l'exécutable
        run: chmod +x calculator
          
      - name: Test DIV
        run: ./calculator div 20 5


  Test_Car:
    runs-on: ubuntu-latest
    needs: Compilation
    steps:
      - name: Télécharger l'exécutable
        uses: actions/download-artifact@v4 # <-- CORRIGÉ : Utilisation de v4
        with:
          name: build-artifacts
          
      - name: Rendre l'exécutable
        run: chmod +x calculator
          
      - name: Test CAR
        run: ./calculator car 5
